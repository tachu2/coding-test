# ユーザー情報更新システム - リファクタリング課題

## 課題内容

このプロジェクトは、ユーザー情報を更新し、変更内容をメール通知するシステムです。
現在の実装は**クリーンアーキテクチャに沿っていません**。

あなたの課題は、このコードを**クリーンアーキテクチャに準拠するようにリファクタリング**することです。

## 現在の実装の問題点

1. **レイヤーの分離がない**
   - ビジネスロジックがコントローラーに直接書かれている
   - DB操作が直接呼ばれている

2. **依存関係が逆転していない**
   - 上位レイヤーが下位レイヤーの具象に依存している
   - インターフェースが使われていない

3. **テストが困難**
   - 外部依存（DB、メール）をモック化できない

4. **責任の分離ができていない**
   - ドメインロジックとインフラストラクチャが混在

## システムの機能とビジネスルール

### 機能

1. **ユーザー情報の更新**
   - 名前、メールアドレス、電話番号を更新可能
   
2. **更新通知メールの送信**
   - 更新があったフィールドを通知

### ビジネスルール（ドメイン知識）

1. **メールアドレス変更時の制約**
   - メールアドレス変更は30日に1回まで
   - 変更時は確認メールを送信

2. **名前変更の制約**
   - 名前は空文字列や数字のみは不可
   - 名前変更は90日に1回まで

3. **更新履歴の保存**
   - 各フィールドの最終更新日時を記録

4. **通知の制御**
   - 重要な変更（メール、名前）は必ず通知
   - 電話番号のみの変更は通知しない

## 現在のファイル構成

```
clean_architecture/
├── user.h              # ユーザー構造体（ドメインロジックなし）
├── database.h          # DB実装（インターフェースなし）
├── mailer.h            # メール送信実装（インターフェースなし）
├── user_controller.h   # 全ロジックが集中
├── main.cpp            # メイン関数
├── Makefile            # ビルド設定
└── README.md           # このファイル
```

## リファクタリング要件

### 期待されるディレクトリ構造

```
clean_architecture/
├── domain/
│   ├── entity/          # User エンティティ
│   ├── repository/      # リポジトリインターフェース
│   └── value_object/    # 値オブジェクト（Email, Name等）
├── usecase/             # ユースケース
├── infrastructure/
│   ├── database/        # DB実装
│   └── email/           # メール送信実装
├── interface/
│   └── controller/      # コントローラー
├── main.cpp
└── Makefile
```

### 実装すべき主要コンポーネント

**Domain層**
- `User` エンティティ（ビジネスルール含む）
- `UserRepository` インターフェース
- `EmailService` インターフェース
- `Email`, `Name` 値オブジェクト

**UseCase層**
- `UpdateUserUseCase`: ユーザー情報更新のビジネスロジック

**Infrastructure層**
- `InMemoryUserRepository`: リポジトリの実装
- `ConsoleEmailService`: メール送信の実装

**Interface層**
- `UserController`: コントローラー

## ビルドと実行

```bash
# ビルド
make

# ビルドして実行
make run

# クリーンアップ
make clean

# 再ビルド
make rebuild
```

または直接：

```bash
g++ -std=c++17 -Wall -Wextra -o user_update main.cpp
./user_update
```

## 評価ポイント

1. **ドメインロジックの独立性**: ビジネスルールがドメイン層に集約されているか
2. **依存関係の逆転**: インターフェースを使った依存性の注入ができているか
3. **単一責任の原則**: 各クラスが1つの責任のみを持っているか
4. **テスタビリティ**: モックを使ったテストが可能な設計か

頑張ってください！
